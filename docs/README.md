# 小型贸易公司进出货 + 账务系统

一个最初为MYF公司设计的轻量级库存管理和账务系统，基于现代Web技术栈构建，提供完整的进出货管理、库存跟踪和数据导出功能。其他“倒货”贸易公司也可以使用。

**注意事项**
- 本项目当前只是为小型贸易公司设计，进货和出货的商品是默认一样的，并不是进出货分开管理的。
- 本项目使用默认使用Node.js + SQLite，只支持小规模并发且体验可能不够好，需要大规模并发请自行适配其他数据库和并配置 Nginx 层。

---

## 🚀 快速上手

### 环境要求
- Node.js >= 20.0.0
- npm >= 8.0.0

### 一键安装和启动

# 安装所有依赖
```
npm run install:all
```

# 启动开发环境 (前端 + 后端)
```
npm run dev
```

- 前端开发服务器: http://localhost:5173
- 后端API服务器: http://localhost:3000
- 生产环境: http://localhost:3000

## 技术架构

### 前端技术栈
- React 19 + React Router 5 + Ant Design + Vite
- 响应式设计，支持桌面和移动设备

### 后端技术栈  
- Node.js (开发基于Node.js v24) + Express + SQLite3
- xlsx库实现Excel导出，内存操作，高性能

---

## 目录结构

```
myf-db-systool/
├── backend/         # 后端服务
│   ├── server.js    # 服务器入口
│   ├── db.js        # 数据库连接
│   ├── routes/      # API路由
│   └── utils/       # 工具函数
├── frontend/        # 前端应用
│   ├── index.html   # 应用入口
│   ├── vite.config.js
│   └── src/
│       ├── App.jsx
│       ├── main.jsx
|       ├── i18n     # 多语言文件
│       └── pages/   # 页面组件
├── package.json     # 项目配置
├── README.md        # 项目说明
└── vibe-coding-prompt.md       # LLM开发辅助文档
```

---

## 使用指南

### 1. 初始化数据

- 系统总览 和 库存明细 页面使用缓存设计，即每次手动点击刷新才会重新计算，并将计算结果保存在一个json文件中，首次启动无法正常加载主页，需要手动点击刷新按钮才会刷新缓存
- 系统总览 页面依赖 库存明细 页面的数据，如果无法正常显示 系统总览 页面，请先刷新 库存明细 页面。

### 2. 基础数据设置
- 客户/供应商管理：添加合作伙伴信息
- 产品管理：添加产品信息
- 产品价格管理：设置产品价格

### 3. 业务操作
- 入库/出库：记录采购和销售，支持数据筛选和即时Excel导出
- 库存查看：监控库存状况，支持库存刷新
- 数据导出：Node.js原生Excel导出，支持基础信息、入库出库记录、应收应付明细

### 页面组织结构
- **总览调试页**：数据库总览、测试数据
- **入库管理页**：代号-简称强绑定AutoComplete输入，支持筛选和数据导出
- **出库管理页**：代号-简称强绑定AutoComplete输入，支持筛选和数据导出
- **库存明细页**：库存查询与统计，**移除库存历史记录功能**，**添加库存刷新功能**，**新增总成本估算显示**（基于库存数量×最新进货单价）
- **客户/供应商管理页**：代号-简称-全称三项联动
- **产品管理页**：代号-简称-型号三项联动
- **产品价格管理页**：价格历史管理
- **应收账款管理页**：实时聚合应收账款、回款记录管理
- **应付账款管理页**：实时聚合应付账款、付款记录管理
- **数据分析页**：按时间区间、客户、产品维度进行销售数据分析，计算销售额、成本、利润和利润率。**新增详细分析功能**：支持查看指定客户的各产品销售明细或指定产品的各客户销售明细

### 4. 智能功能
- **代号-简称强绑定输入**：入库/出库界面支持输入代号或简称，自动补全匹配项
- **三项联动校验**：客户/供应商、产品的代号-简称-全称/型号强绑定，确保数据一致性
- **自动价格与金额计算**：根据历史价格自动填充，库存自动更新
- **状态可视化**：付款/回款状态标识，进度跟踪
- **批量导入/导出**：支持Excel等格式的数据批量处理

### 5. 数据分析功能
- **多维度分析**：支持按时间区间、客户、产品等维度进行数据分析
- **财务指标计算**：自动计算销售额、成本、利润和利润率
- **详细分析表格**：当选择指定客户时显示该客户各产品销售明细，当选择指定产品时显示该产品各客户销售明细
- **智能显示逻辑**：只有销售额大于0的记录才会显示在详细表格中
- **缓存优化**：采用缓存机制提升查询性能，自动清理30天以上的过期缓存
- **灵活筛选**：支持全部客户/产品或指定客户/产品的分析
- **实时刷新**：支持手动刷新重新计算最新数据

### 6. 配置管理
- **统一配置文件**：`data/appConfig.json` 集中管理所有应用配置项
  - **付款/回款方式**：支持现金、银行转账、支票、承兑汇票、在线支付等多种方式
  - **产品类别**：预设常用产品分类，如电子产品、机械设备、办公用品等
- **配置导出模块**：`data/exportConfig.json` 可以方便修改报表导出xlsx文件中列的顺序

### 6. 配置管理
- **统一配置文件**：`data/appConfig.json` 集中管理所有应用配置项
  - **付款/回款方式**：支持现金、银行转账、支票、承兑汇票、在线支付等多种方式
  - **产品类别**：预设常用产品分类，如电子产品、机械设备、办公用品等
- **配置导出模块**：`data/exportConfig.json` 可以方便修改报表导出xlsx文件中列的顺序

### 7. 应收/应付账款管理
- **应收账款**：实时聚合客户欠款，支持回款记录和明细查询
- **应付账款**：实时聚合供应商欠款，支持付款记录和明细查询
- **账款明细**：详细的付款/回款记录，支持多种支付方式
- **状态跟踪**：可视化账款状态，自动计算余额和逾期情况

---

## 常用开发命令

### 根目录
```bash
npm run install:all   # 安装所有依赖
npm run dev           # 启动开发环境
npm run build         # 构建生产版本
npm start         # 启动生产环境
```

---

##  数据库核心表

- **inbound_records**：入库记录（含supplier_code、product_code字段
- **outbound_records**：出库记录（含customer_code、product_code字段
- **partners**：客户/供应商（代号-简称-全称强绑定
- **products**：产品信息（代号-简称-型号强绑定
- **product_prices**：产品价格（按日期管理

---

## 主要API接口

- 详见 `vibe-coding-prompt.md` 文档，或参考 `/backend/routes/` 目录源码

---

##  用户界面

- **Ant Design风格**：现代化UI设计，响应式布局
- **智能表单**：AutoComplete组件实现代号-简称强绑定输入，流畅操作体验
- **数据表格**：支持分页、排序、筛选、批量操作
- **状态标识**：可视化付款/回款状态，操作反馈
- **移动端适配**：支持桌面和移动设备访问

---

## 性能与扩展

### 性能优化
- **前端**：代码分割、懒加载、缓存优化
- **后端**：分页查询、索引优化
- **导出功能**：内存操作，响应时间<50ms，支持小规模并发

### 扩展功能

- [x] Node.js原生Excel导出
- [x] 多语言适配，当前已适配中文，英文和韩文
- [ ] 文件上传、Excel导入功能
- [ ] 用户权限管理系统
- [ ] 数据备份与恢复
